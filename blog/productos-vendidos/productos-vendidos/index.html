<!DOCTYPE html>
<html lang="en-us"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="generator" content="Hugo 0.123.7">
	
	<link rel="icon" href="/images/logo.png">
	
	<title>Portafolio | Alberto Ortiz</title>
	
	

	<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="¿Qué productos se venden más en los supermercados en México? Análisis con Spark"/>
<meta name="twitter:description" content="El conocer a nuestros consumidores la mayoría de las veces es de gran relevancia para las empresas ya que logran obtener datos de los productos que más venden, logrando con esto mantener sus almacenes con los productos en existencia."/>

	<meta property="og:title" content="¿Qué productos se venden más en los supermercados en México? Análisis con Spark" />
<meta property="og:description" content="El conocer a nuestros consumidores la mayoría de las veces es de gran relevancia para las empresas ya que logran obtener datos de los productos que más venden, logrando con esto mantener sus almacenes con los productos en existencia." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://caoba1623.github.io/blog/productos-vendidos/productos-vendidos/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-07-29T11:40:11+02:00" />
<meta property="article:modified_time" content="2020-07-29T11:40:11+02:00" />



	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">

	
	<link rel="stylesheet" href="https://caoba1623.github.io/css/medium.6971b630a000d0cbb4d82c9a9ec50c3a9065960184ea012350c9d0f97b825f8b.css" integrity="sha256-aXG2MKAA0Mu02CyansUMOpBllgGE6gEjUMnQ&#43;XuCX4s=">

	
	<link rel="stylesheet" href="https://caoba1623.github.io/css/additional.8819b6defcdc6d21280f9b402b00df87ca779135901de6c22e708c62e20184b9.css" integrity="sha256-iBm23vzcbSEoD5tAKwDfh8p3kTWQHebCLnCMYuIBhLk=">

	
	
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
    <div class="container pr-0">
        
        <a class="navbar-brand" href="https://caoba1623.github.io//">

            
            <img src="/images/logo.png" alt="logo">
            
        </a>
        

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/blog">Blog</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/">About Me</a>
                </li>
                
            </ul>
        </div>
        
    </div>
</nav>


        <div class="site-content">   
            <div class="container">
    
    <div class="main-content">
        
        <div class="container">
            <div class="row">
                
                <div class="col-md-2 pl-0"><div class="share sticky-top sticky-top-offset">
    

    
</div>
</div>
                                
                <div class="col-md-9 flex-first flex-md-unordered">
                    <div class="mainheading">
                        	
                        
                        
                        
                        <div class="row post-top-meta">
                            <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0 md-nopad-right">
                                <img class="author-thumb" src="/images/author.jpeg" alt="Alberto Ortiz">
                            </div>
                            <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left md-nopad-left">
                                <a target="_blank" class="link-dark">Alberto Ortiz</a><br>
                                <span class="author-description">
                                    Data Engineer<br>
                                    <i class="far fa-star"></i>
                                    Jul 29, 2020
                                    <i class="far fa-clock clock"></i>
                                    3 min read
                                </span>					
                            </div>
                        </div>			
                        	
                        
                                                
                        
                        <h1 class="posttitle">¿Qué productos se venden más en los supermercados en México? Análisis con Spark</h1> 
                    </div>
                    <img class="featured-image img-fluid" src="/images/blog/blog04.jpg" alt="thumbnail for this post">
                    

                    
                    <div class="article-post">
                        <p>El conocer a nuestros consumidores la mayoría de las veces es de gran relevancia para las empresas ya que logran obtener datos de los productos que más venden, logrando con esto mantener sus almacenes con los productos en existencia.</p>
<p>El día de hoy nos centraremos en realizar un analísis de los principales cadenas de supermercados que se encuentran dentro de México, y veremos cuáles de sus productos son los que se venden con las frecuencia por estado.</p>
<p>Los datos los obtuve de la página de datos abiertos de México, aquí el link. El analísis será con PySpark, bien vamos a comenzar.</p>
<p>Como siempre vamos a importar las bibliotecas (NO librerías) correspondientes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pyspark.sql <span style="color:#f92672">import</span> SparkSession
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pyspark.sql
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pyspark.sql.functions <span style="color:#66d9ef">as</span> func
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pyspark.sql.window <span style="color:#f92672">import</span> Window
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pyspark.sql.functions <span style="color:#f92672">import</span> countDistinct
</span></span></code></pre></div><p>Para tener la capacidad de usar todas las capacidades de Spark necesitamos crear la clase SparkSession, y para crear una sesión de spark es como sigue:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>spark <span style="color:#f92672">=</span> SparkSession \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>builder \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>appName(<span style="color:#e6db74">&#34;analisis de supermercados cdmx&#34;</span>) \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>config(<span style="color:#e6db74">&#34;spark.some.config.option&#34;</span>, <span style="color:#e6db74">&#34;some-value&#34;</span>) \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>getOrCreate()
</span></span></code></pre></div><p>Una vez creada la sesión podemos usar las funciones de spark, lo primero que haremos es importar el conjunto de datos llamado all_data.csv.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df <span style="color:#f92672">=</span> spark<span style="color:#f92672">.</span>read<span style="color:#f92672">.</span>csv(<span style="color:#e6db74">&#34;all_data.csv&#34;</span>, header<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><p>Una vez cargados los datos vamos a revisar el nombre y tipo de las columnas:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>printSchema()
</span></span></code></pre></div><p><img src="https://drive.google.com//uc?id=1zMxbiVWsFeNOKRpcAQFsTnnqeQy_GSCV" alt=""></p>
<p>Colocamos en pantalla los primeros cinco registros de los datos:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>limit(<span style="color:#ae81ff">5</span>)<span style="color:#f92672">.</span>toPandas()
</span></span></code></pre></div><p><img src="https://drive.google.com//uc?id=1V2zNX6Jxgql928fkZTgUuCuHvF8LykfD=" alt=""></p>
<p>Analizamos a qué se refiere cada una de las columnas de los datos.</p>
<ul>
<li><strong>producto</strong>: se refiere al nombre que recibe el producto en la tienda</li>
<li><strong>presentacion</strong>: tipo de características que tiene el producto</li>
<li><strong>marca</strong>: nombre de la empresa que lo hizo</li>
<li><strong>categoria</strong>: categoría a la cual pertenece el producto dentro de la tienda</li>
<li><strong>catalogo</strong>: en cada tienda manejan un catálogo para identificar facilmente en donde se localiza el producto</li>
<li><strong>precio</strong>: el precio de venta del producto en la tienda</li>
<li><strong>fechaRegistro</strong>: fecha de registro del producto al llegar a la tienda</li>
<li><strong>cadenaComercial</strong>: nombre de la cadena de supermercado al que pertenece</li>
<li><strong>giro</strong>: el giro al que pertenece la tienda</li>
<li><strong>nombreComercial</strong>: nombre de la tienda comercial</li>
<li><strong>direccion</strong>: ubicación de la tienda</li>
<li><strong>estado</strong>: el estado en donde se encuentra la tienda físicamente</li>
<li><strong>municipio</strong>: el municipio en donde se encuentra la tienda físicamente</li>
<li><strong>latitud y longitud</strong>: coordendas geográficas de la tienda física.</li>
</ul>
<p>¿Cuántos registros tiene el conjunto de datos?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Número de registros: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(df<span style="color:#f92672">.</span>count()))
</span></span></code></pre></div><h3 id="número-de-registros-62530715">Número de registros: 62530715</h3>
<p>Vamos a revisar cuántas categorías hay en los datos.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>gr <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>select(df[<span style="color:#e6db74">&#39;categoria&#39;</span>])<span style="color:#f92672">.</span>distinct()<span style="color:#f92672">.</span>count()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Número de categorías: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(gr))
</span></span></code></pre></div><h3 id="número-de-categorías-42">Número de categorías: 42</h3>
<p>Revisemos cuántas cadenas comerciales hay en los datos.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>gr <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>select(df[<span style="color:#e6db74">&#39;nombreComercial&#39;</span>])<span style="color:#f92672">.</span>distinct()<span style="color:#f92672">.</span>count()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Número de cadenas comerciales: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(gr))
</span></span></code></pre></div><h3 id="número-de-cadenas-comerciales-3895">Número de cadenas comerciales: 3895</h3>
<p>Ahora vamos a ver cuáles son los productos que más consumen los mexicanos por estado.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>gr <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>groupBy(<span style="color:#e6db74">&#34;estado&#34;</span>, <span style="color:#e6db74">&#34;producto&#34;</span>)<span style="color:#f92672">.</span>agg(func<span style="color:#f92672">.</span>count(<span style="color:#e6db74">&#34;producto&#34;</span>)<span style="color:#f92672">.</span>alias(<span style="color:#e6db74">&#34;num_productos&#34;</span>))
</span></span><span style="display:flex;"><span>maxWindowSpec <span style="color:#f92672">=</span> Window()<span style="color:#f92672">.</span>partitionBy(<span style="color:#e6db74">&#34;estado&#34;</span>)
</span></span><span style="display:flex;"><span>maxColumn <span style="color:#f92672">=</span> func<span style="color:#f92672">.</span>max(<span style="color:#e6db74">&#34;num_productos&#34;</span>)<span style="color:#f92672">.</span>over(maxWindowSpec)
</span></span><span style="display:flex;"><span>dfWithMax <span style="color:#f92672">=</span> gr<span style="color:#f92672">.</span>withColumn(<span style="color:#e6db74">&#34;max_num_productos&#34;</span>,maxColumn)
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> dfWithMax<span style="color:#f92672">.</span>filter(<span style="color:#e6db74">&#34;max_num_productos - num_productos == 0&#34;</span>)<span style="color:#f92672">.</span>orderBy(<span style="color:#e6db74">&#39;max_num_productos&#39;</span>, ascending<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)<span style="color:#f92672">.</span>drop(<span style="color:#e6db74">&#34;max_num_productos&#34;</span>,<span style="color:#e6db74">&#34;num_productos&#34;</span>)
</span></span><span style="display:flex;"><span>result<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="https://drive.google.com//uc?id=1etuprpNhlZjx5UYpQ5x_5as5FQEsEIkJ" alt=""></p>
<p>Es interesante ver que el refresco es lo más consumido por los mexicanos, seguido también se compran con más frecuencia la leche y alimentos FUD como jamón y salchicha. Comunmente la finalidad de comprar el refresco en los supermercados es porque son para fiestas o reuniones familiares es por ello que se compran muchos paquetes de refresco.</p>
<p>¿Cuál será la tienda que tiene mas variedad de productos?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>gr <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#34;nombreComercial&#34;</span>, <span style="color:#e6db74">&#34;producto&#34;</span>)<span style="color:#f92672">.</span>groupBy(<span style="color:#e6db74">&#34;nombreComercial&#34;</span>)<span style="color:#f92672">.</span>agg(countDistinct(<span style="color:#e6db74">&#34;producto&#34;</span>)<span style="color:#f92672">.</span>alias(<span style="color:#e6db74">&#34;num_productos_distintos&#34;</span>))<span style="color:#f92672">.</span>orderBy(<span style="color:#e6db74">&#39;num_productos_distintos&#39;</span>, ascending<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>gr<span style="color:#f92672">.</span>show(<span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><p><img src="https://drive.google.com//uc?id=16xEQm3Uhaf4TXnwmPpnxoo3fkoxZX4KM" alt=""></p>
<p>Ahora presentaré un pequeño mapa con sólo algunas de las tiendas y productos que venden del estado de Guanajuato dado que tenemos sus coordenadas geográficas.</p>
<p><img src="https://drive.google.com//uc?id=1w0TSvZA6Wpjd5ijmt2RYWaIaYjOh_xD2" alt=""></p>
<p>Por el momento esto es todo, espero que les sea de ayuda al iniciar con spark. Saludos.</p>

                    </div>
                    
                    
                    <div class="after-post-tags">
                        <ul class="tags">
                        
                        <li>
                        <a href="/tags/pyspark">pyspark</a>
                        </li>
                        
                        <li>
                        <a href="/tags/retail">retail</a>
                        </li>
                        
                        <li>
                        <a href="/tags/analisis">analisis</a>
                        </li>
                        
                        <li>
                        <a href="/tags/exploracion">exploracion</a>
                        </li>
                        
                        </ul>
                    </div>
                    
                    
                    
                    <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
                    
                        <a class="d-block col-md-6" href="https://caoba1623.github.io/blog/preprocesamiento-nlp/preprocesamiento-nlp/"> &laquo; Preprocesamiento de Texto NLP</a>
                    
                    
                        <a class="d-block col-md-6 text-lg-right" href="https://caoba1623.github.io/blog/delitos-exploracion/delitos-exploracion/">Exploración de los delitos en la CDMX &raquo;</a>
                    
                    <div class="clearfix"></div>
                    </div>
                    
                </div>
                
            </div>
        </div>
        
        
    </div>


            </div>
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
			<div class="d-md-flex align-items-center justify-content-center h-100">
				<h2 class="d-md-block d-none align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
			</div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
			
			<a class="mt-1 mb-1" href="/tags/analisis">analisis</a>
			
			<a class="mt-1 mb-1" href="/tags/cdmx">cdmx</a>
			
			<a class="mt-1 mb-1" href="/tags/cnn">cnn</a>
			
			<a class="mt-1 mb-1" href="/tags/convolucion">convolucion</a>
			
			<a class="mt-1 mb-1" href="/tags/crimen">crimen</a>
			
			<a class="mt-1 mb-1" href="/tags/delitos">delitos</a>
			
			<a class="mt-1 mb-1" href="/tags/exploracion">exploracion</a>
			
			<a class="mt-1 mb-1" href="/tags/fake-news">fake news</a>
			
			<a class="mt-1 mb-1" href="/tags/hyperparameter-optimization">hyperparameter optimization</a>
			
			<a class="mt-1 mb-1" href="/tags/interesting">interesting</a>
			
			<a class="mt-1 mb-1" href="/tags/keras">keras</a>
			
			<a class="mt-1 mb-1" href="/tags/machine-learning">machine learning</a>
			
			<a class="mt-1 mb-1" href="/tags/mnist">mnist</a>
			
			<a class="mt-1 mb-1" href="/tags/n-gram">n-gram</a>
			
			<a class="mt-1 mb-1" href="/tags/natural-languaje-processing">natural languaje processing</a>
			
			<a class="mt-1 mb-1" href="/tags/nlp">nlp</a>
			
			<a class="mt-1 mb-1" href="/tags/pyspark">pyspark</a>
			
			<a class="mt-1 mb-1" href="/tags/python">python</a>
			
			<a class="mt-1 mb-1" href="/tags/red-neuronal-recurrente">red neuronal recurrente</a>
			
			<a class="mt-1 mb-1" href="/tags/redes-neuronales">redes neuronales</a>
			
			<a class="mt-1 mb-1" href="/tags/retail">retail</a>
			
			<a class="mt-1 mb-1" href="/tags/scipy">scipy</a>
			
			<a class="mt-1 mb-1" href="/tags/series-de-tiempo">series de tiempo</a>
			
			<a class="mt-1 mb-1" href="/tags/sklearn">sklearn</a>
			
			<a class="mt-1 mb-1" href="/tags/tensorflow">tensorflow</a>
			
			<a class="mt-1 mb-1" href="/tags/tf-idf">tf-idf</a>
			
			<a class="mt-1 mb-1" href="/tags/timeseries">timeseries</a>
			
			<a class="mt-1 mb-1" href="/tags/weights-biases">weights &amp; biases</a>
			
		</div>
	</div>
</div>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright Alberto Ortiz - All rights reserved
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" rel="noopener" href="https://www.wowthemes.net">Mediumish Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>


        </div>


<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


<script src="https://caoba1623.github.io/js/mediumish.84218587c174fd40bce82544b98851670f0b124a7324b349c54a4065e2b32ffc.js" integrity="sha256-hCGFh8F0/UC86CVEuYhRZw8LEkpzJLNJxUpAZeKzL/w="></script>
    </body>
</html>
